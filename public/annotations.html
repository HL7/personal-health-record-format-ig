<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>Annotations - Personal Health Records v1.0.0-ballot</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link href="fhir.css" rel="stylesheet"/>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap-fhir.css" rel="stylesheet"/>

    <!-- Project extras -->
    <link href="assets/css/project.css" rel="stylesheet"/>
    <link href="assets/css/pygments-manni.css" rel="stylesheet"/>
    <link href="assets/css/jquery-ui.css" rel="stylesheet"/>
  	<link href="assets/css/prism.css" rel="stylesheet" />
  	<link href="assets/css/cqf.css" rel="stylesheet" />
    <!-- Placeholder for child template CSS declarations -->
    <link href="assets/css/hl7.css" rel="stylesheet"/>
    <link href="assets/css/fhir-ig.css" rel="stylesheet"/>

    <script type="text/javascript" src="fhir-table-scripts.js"> </script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

    <!-- Favicons -->
    <link rel="fhir-logo" sizes="144x144" href="assets/ico/icon-fhir-144.png"/>
    <link rel="fhir-logo" sizes="114x114" href="assets/ico/icon-fhir-114.png"/>
    <link rel="fhir-logo" sizes="72x72" href="assets/ico/icon-fhir-72.png"/>
    <link rel="fhir-logo" href="assets/ico/icon-fhir-57.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>
    <script type="text/javascript" src="assets/js/mermaid.js"></script>
    <script type="text/javascript" src="assets/js/mermaid-init.js"></script>
    <style type="text/css">h2{--heading-prefix:"7"}
    h3,h4,h5,h6{--heading-prefix:"7"}</style>
    <div id="segment-header" class="segment">  <!-- segment-header -->
      <div class="container">  <!-- container -->
        <!-- Placeholder for child template header declarations -->

        <div id="hl7-nav">
          <a id="hl7-logo" no-external="true" href="http://hl7.org">
            <img height="50" alt="Visit the HL7 website" src="assets/images/hl7-logo-header.png"/>
          </a>
        </div>
        <div id="family-nav">
          <a id="family-logo" no-external="true" href="http://hl7.org/fhir"><img height="50" alt="Visit the FHIR website" src="assets/images/fhir-logo-www.png"/> </a>
        </div>
        <div id="hl7-search">
          <a id="hl7-search-lnk" no-external="true" href="searchform.html"><img alt="Search FHIR" src="assets/images/search.png"/></a>
        </div>


        <div id="ig-status">
          <p><span style="font-size:12pt;font-weight:bold">Personal Health Records</span>
            <br/>
            <span style="display:inline-block;">1.0.0-ballot - ballot



  <img alt="International flag" src="assets/images/001.svg" height="16" title="International"/>


            </span>
          </p>
        </div>
      </div> <!-- /container -->
    </div>  <!-- /segment-header -->

    <div id="segment-navbar" class="segment">  <!-- segment-navbar -->
      <div id="stripe"> </div>
      <div class="container">  <!-- container -->
        <!-- HEADER CONTENT -->

        <nav class="navbar navbar-inverse">
          <!--status-bar-->
          <div class="container">
            <button data-target=".navbar-inverse-collapse" class="navbar-toggle" data-toggle="collapse" type="button">
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
            </button>
            <a class="navbar-brand hidden" href="http://hl7.org/fhir/R4/index.html">FHIR</a>
            <div class="nav-collapse collapse navbar-inverse-collapse">
              <!-- menu.xml  -->

<ul xmlns="http://www.w3.org/1999/xhtml" class="nav navbar-nav">
  <li>
    <a href="index.html">Home</a>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Functional Model
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="conformance.html">Conformance</a>
      </li>
      <li>
        <a href="datamodel.html">Data Model</a>
      </li>
      <li>
        <a href="functionality.html">Functional Model</a>
      </li>
      <li>
        <a href="recordlifecycle.html">Record Lifecycle</a>
      </li>
      <li>
        <a href="security.html">Security</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Supplemental
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="history.html">History</a>
      </li>
      <li>
        <a href="recordkeeping.html">Record Keeping</a>
      </li>
      <li>
        <a href="longitudinal.html">Longitudinal Records</a>
      </li>
      <li>
        <a href="api.html">API Endpoints</a>
      </li>
      <li>
        <a href="annotations.html">Annotations</a>
      </li>
      <li>
        <a href="algorithms.html">Algorithms</a>
      </li>
      <li>
        <a href="physiology.html">Physiology Domains</a>
      </li>
      <li>
        <a href="operating-systems.html">Operating Systems</a>
      </li>
    </ul>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Patient Personas
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="personas-index.html">Index</a>
      </li>
      <li>
        <a href="persona-thompson-family.html">Thompson Familiy</a>
      </li>
      <li>
        <a href="persona-journey-b.html">Cancer - Adult</a>
      </li>
      <li>
        <a href="persona-william.html">Cancer - Pediatric</a>
      </li>
      <li>
        <a href="persona-journey-e.html">Chronic Illness (Lupus)</a>
      </li>
      <li>
        <a href="persona-journey-d.html">Long COVID</a>
      </li>
      <li>
        <a href="persona-journey-a.html">Patient Relocation</a>
      </li>
      <li>
        <a href="persona-journey-c.html">Sports Outpatient / Cardiac</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="artifacts.html">Artifacts</a>
  </li>
</ul>
            </div>  <!-- /.nav-collapse -->
          </div>  <!-- /.container -->
        </nav>  <!-- /.navbar -->
      <!-- /HEADER CONTENT -->
      </div>  <!-- /container -->
    </div>  <!-- /segment-navbar -->
    <!--status-bar-->

    <div id="segment-breadcrumb" class="segment">  <!-- segment-breadcrumb -->
      <div class="container">  <!-- container -->
        <ul class="breadcrumb">
          <li><a href='toc.html'><b>Table of Contents</b></a></li><li><b>Annotations</b></li>

        </ul>
      </div>  <!-- /container -->
    </div>  <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">  <!-- segment-content -->
      <div class="container">  <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<style type="text/css">
h2:before{color:silver;counter-increment:section;content:var(--heading-prefix) " ";}
h3:before{color:silver;counter-increment:sub-section;content:var(--heading-prefix) "." counter(sub-section) " ";}
h4:before{color:silver;counter-increment:composite;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) " ";}
h5:before{color:silver;counter-increment:detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) " ";}
h6:before{color:silver;counter-increment:more-detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) "." counter(more-detail)" ";}
</style>
<div class="col-12">
  <!--ReleaseHeader--><p id="publish-box">Personal Health Records - Local Development build (v1.0.0-ballot) built by the FHIR (HL7® FHIR® Standard) Build Tools. See the <a href="http://hl7.org/fhir/uv/phr/history.html">Directory of published versions</a></p><!--EndReleaseHeader-->
  <h2>Annotations</h2>
  












    <p><!-- white space is critical inside of capture --></p>
<div class="markdown-toc">
<ul id="markdown-toc">
  <li><a href="#patient-use-cases" id="markdown-toc-patient-use-cases">Patient Use cases</a>    <ul>
      <li><a href="#who-holds-the-health-record" id="markdown-toc-who-holds-the-health-record">Who holds the health record?</a></li>
      <li><a href="#managing-the-health-record" id="markdown-toc-managing-the-health-record">Managing the health record</a></li>
      <li><a href="#correcting-the-health-record" id="markdown-toc-correcting-the-health-record">Correcting the health record</a></li>
    </ul>
  </li>
  <li><a href="#provider-use-cases" id="markdown-toc-provider-use-cases">Provider use cases</a></li>
  <li><a href="#intent" id="markdown-toc-intent">Intent</a></li>
  <li><a href="#specification" id="markdown-toc-specification">Specification</a>    <ul>
      <li><a href="#encrypted-string" id="markdown-toc-encrypted-string">Encrypted String</a></li>
      <li><a href="#versions" id="markdown-toc-versions">Versions</a></li>
      <li><a href="#attachments" id="markdown-toc-attachments">Attachments</a></li>
    </ul>
  </li>
  <li><a href="#use-with-pdfs" id="markdown-toc-use-with-pdfs">Use with PDFs</a></li>
</ul>

</div>
<p>Once an encrypted Personal Health Record is generated, that has been cryptographically signed, patients, clinicians, and others may have an interest in correcting, amending, or annotating the record, without breaking the cryptographic signature.  The SPHR standard offers the Annotation functionality for such cases.</p>

<h2 id="patient-use-cases">Patient Use cases</h2>

<h3 id="who-holds-the-health-record">Who holds the health record?</h3>

<p>Some patient summary distribution systems are focusing on retaining the document so that 
the patient doesn't keep their own copy, while other systems are focused on getting the 
IPS to the patient directly, either by push or pull.</p>

<p>If a patient doesn't actually get their health record or patient summary, and instead receive only a token to it such as a QR code or URL, what exactly do they get?</p>

<p>If would be good to have a consistent workflow around IPS handling whether the document 
is held directly by the patient or not.</p>

<h3 id="managing-the-health-record">Managing the health record</h3>

<p>Patients will need software support for managing their patient summaries. The 
software will have concerns around:</p>

<ul>
  <li>recognising which incoming attachments/documents are PHR files (inclusive of IPS documents)</li>
  <li>showing them to the user correctly (how to describe them in a list)</li>
  <li>Patients might wish to password protect their summary</li>
</ul>

<h3 id="correcting-the-health-record">Correcting the health record</h3>

<p>Furthermore, consultation with patients brings forward a very clear requirement indeed: 
if we're going to pass the summary on, we need to be able to comment on it, or correct it. 
Most clinical records contain inaccuracies, or information that a patient wishes to 
clarify or extend because the summary is too brief or too clinical. A patient may (should)
hesitate to pass on a patient summary containing information. For this reason, the 
IPS infrastructure needs to make allowance for patient corrections to the summary.</p>

<h2 id="provider-use-cases">Provider use cases</h2>

<p>On the other hand, not all patient corrections will be correct or appropriate, or even
well-meaning. It is of critical importance for clinical practice to know whether the 
information that a clinician is presented is patient sourced, or from a clinician, and if so, who,
and whether it is reliable.</p>

<p>It's easy to sign documents such that it's digitally provable that the document has 
not been changed since it was created, but equally, integrating information between 
different information contexts requires transformation of coded values, record
identity, and even language translation, and none of those are compatible with 
digital signatures (it's for this reason that digital signatures are associated 
with <em>past</em> information).</p>

<p>One of the key challenges IPS adoption faces is how the transformation requirements that 
interoperability imposes with the integrity requirements clinicians identity, while allowing
patients to manage information that they believe is wrong or unclear in context.</p>

<h2 id="intent">Intent</h2>

<p>This specification describes a wrapper format for an IPS document that treats
the IPS as a series of versions of the same document, each of which is able to be 
digitally signed, and a mix of human and algorithmic approaches can ensure integrity
from beginning to end.</p>

<h2 id="specification">Specification</h2>

<p>An PHR annotation is a .zip file that contains the SPHR file, along with a file manifest.json 
that describes the contents of the package. The package may contain more than one 
version of the IPS, along with associated supporting collateral - attachments, 
stylesheets and branding information. In addition the document may be signed or encrypted.</p>

<p>The file manifest.json always contains two properties:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">format</code> : a fixed string that specifies the version of the wrapper. Current value: <code class="language-plaintext highlighter-rouge">ips-wrapper/1</code></li>
  <li><code class="language-plaintext highlighter-rouge">description</code> : A short label that describes the content that may be used when describing the document in a user interface. This should not include any patient specific information. A typical value would be "Patient Summary from Good Health Hospital". Note that not all institutions should be named e.g. specialist clinical services such as reproductive or mental health should not be named</li>
</ul>

<p>The manifest file may contain a combination of three additional properties:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">encrypted</code>: a JSON Web encrypted string that contains the actual IPS, keyed to a user provided pass-phrase. When successfully decrypted, it contains another PHR Annotation.</li>
  <li><code class="language-plaintext highlighter-rouge">versions</code>: A list of JSON objects describing the versions of the IPS contained in the wrapper. Note that all the IPS documents are different versions of the same IPS</li>
  <li><code class="language-plaintext highlighter-rouge">attachments</code>: A list JSON objects describing attachments to the IPS</li>
</ul>

<p>The mainfest will contain either <code class="language-plaintext highlighter-rouge">encrypted</code> or <code class="language-plaintext highlighter-rouge">versions</code>, but not both. The encrypted wrapper may 
contain unencrypted attachments; these are combined with the encrypted attachments.</p>

<p>The PHR annotation SHALL not contain any files not described in the manifest.</p>

<h3 id="encrypted-string">Encrypted String</h3>

<p>When encrypted, the content is contained as a JWE encrypted string. 
Encryption is performed using JOSE JWE compact serialization with "alg": "dir" and "enc": "A256GCM", as is done for SHLinks.
The key for decryption is generated from a patient provided passphrase using the following procedure:</p>

<ul>
  <li><em>todo</em></li>
</ul>

<h3 id="versions">Versions</h3>

<p>Each version of the IPS represented in the manifest is a JSON object with the following properties:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">source</code> (required): a url that references the source of this version of the IPS. The reference may be relative, in which case it is a reference to a file contained in the PHR annotation, or it might an absolute URL that references the location of the IPS in some storage service. The following URL protocols are allowed: https or shlink:. Authentication may be required; if so, it should be conformant with the IPA specification (https) or conform to the Smart Health Links Specification</li>
  <li><code class="language-plaintext highlighter-rouge">date</code> (required): Epoch seconds at the time at which this version was created</li>
  <li><code class="language-plaintext highlighter-rouge">kind</code> (required): what kind of version of the IPS this is. Allowed values:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">original</code>: The originally produced IPS from the source clinical system</li>
      <li><code class="language-plaintext highlighter-rouge">transform</code>: A post-production algorithm transform of the IPS. (see below for transform details)</li>
      <li><code class="language-plaintext highlighter-rouge">annotation</code>: The same IPS, but with additional annotations added (usually by a patient, but it doesn't have to be)</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">agent</code> (required): A human readable label for the agency (organization) that produced the document e.g. "Good Health Clinic System",</li>
  <li><code class="language-plaintext highlighter-rouge">signature</code> (optional): A SHC based verifiable credential, but where the fhirBundle is not provided, it is assumed to be whatever is in <code class="language-plaintext highlighter-rouge">source</code></li>
  <li><code class="language-plaintext highlighter-rouge">transform</code> (depends): If kind=transform or annotation, required details about the transform. The transform property is a JSON object with two properties:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">source</code> (optional) : A url that references the source of this transform. If present, it SHALL be equal to the source value of one of the other versions in the wrapper</li>
      <li>"action" (required) : An array of the kinds of actions that were taken by the transform. One or more of the following values:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">recode</code> - original codes (e.g. clinical codes - problems, medications) were changed to internationally conformant codes</li>
          <li><code class="language-plaintext highlighter-rouge">re-id</code> - the resource identities were changed (to align to a secondary data repository)</li>
          <li><code class="language-plaintext highlighter-rouge">translate</code> - the language was translated (where possible/appropriate)</li>
          <li><code class="language-plaintext highlighter-rouge">shrink</code> - attachments were reduced in size (usually by reducing their resolution)</li>
          <li><code class="language-plaintext highlighter-rouge">annotate</code> - An annotation section was added at the top of the document</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>Annotation: if kind = annotation, then this is a claim that an agent (usually a human, most often the patient) added 
a correction/clarification section at the start of the IPS where the patient (usually), clarifies or corrects information 
found in the rest of the document (see above). Authoring software SHALL not allow the patient to correct information 
found in the other sections, and the document should be identical with regard to other sections (this can be verified 
by removal of the top-most (first) annotation section; the document should be identical, to the point of maintaining 
digital signature)</p>

<p>The default version to display is the most recent, though displaying software should display the kind clearly along 
with the document, and may let users choose other versions.</p>

<h3 id="attachments">Attachments</h3>

<p>Each attachment represented in the manifest is a JSON object with the following properties:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">source</code> (required): A url that references the attachment. The reference may be relative, in which case it is a reference to a file contained in the PHR annotation, or it might an absolute URL that references the location of the attachment in some storage service. The following protocols are allowed: https, http. Authentication SHALL not be required to access the attachment</li>
  <li><code class="language-plaintext highlighter-rouge">contentType</code> (required): the mime type of the attachment</li>
  <li><code class="language-plaintext highlighter-rouge">kind</code> (required): the purpose of the attachment. One of the following values:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">icon</code>: an image of size 32x32 or 64x64 that is recommended to use when displaying this IPS in a list of known IPS documents</li>
      <li><code class="language-plaintext highlighter-rouge">brand</code>: a FHIR bundle that represents the brand of the source (as defined by smart-app-launch)</li>
      <li><code class="language-plaintext highlighter-rouge">attachment</code>: a file that is referred to from the narrative or data of the IPS. Typically, an image, video, or pdf</li>
      <li><code class="language-plaintext highlighter-rouge">stylesheet</code>: A CSS stylesheet that <em>may</em> be used when rendering the IPS</li>
      <li><code class="language-plaintext highlighter-rouge">author-image</code>: a plain text representation or image of the content that the original author saw and signed (for legal non-repudiation reasons)</li>
    </ul>
  </li>
</ul>

<p>when an IPS encryption wrapper contains an attachment, and the unecryption of it contains an attachment with the same name, the encrpyted attachment takes precedence</p>

<h2 id="use-with-pdfs">Use with PDFs</h2>

<p>A valid way to send an IPS is as a PDF (signed or not) that contains a file attachment named 'patient-summary.ips.zip'.
This way, any device that supports PDF (almost all of them) can display the PDF, and the data attachment may be accessed by IPS aware software</p>



</div>
        </div>  <!-- /inner-wrapper -->
      </div>  <!-- /row -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-content -->

  <script type="text/javascript" src="assets/js/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script type="text/javascript" src="assets/js/jquery-ui.min.js"> </script>

  <script type="text/javascript" src="assets/js/window-hash.js"> </script>
  <a name="bottom"> </a>
  <div id="segment-footer" igtool="footer" class="segment">  <!-- segment-footer -->
    <div class="container">  <!-- container -->

      <div class="inner-wrapper">
        <p>
          IG &#169; 2022+ <a style="color:var(--footer-hyperlink-text-color)" href="http://www.hl7.org/Special/committees/patientempowerment">HL7 International / Patient Empowerment</a>.  Package hl7.fhir.uv.phr#1.0.0-ballot based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R4/">FHIR 4.0.1</a>. Generated <span title="Wed, Dec 18, 2024 11:20-0600">2024-12-18</span>
          <br/>
          <span style="color: var(--footer-highlight-text-color)">
                      Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                 
                
                 | <a style="color: #81BEF7" target="_blank" href="http://hl7.org/fhir/uv/phr/history.html">Version History</a> |
                 <a style="color: #81BEF7" rel="license" href="http://hl7.org/fhir/R4/license.html"><img style="border-style: none;" alt="CC0" src="cc0.png"/></a> |
                 <!--<a style="color: #81BEF7" href="todo.html">Search</a> | --> 
                 <a style="color: #81BEF7" target="_blank" href="http://hl7.org/fhir-issues">Propose a change</a>
          </span>
        </p>
      </div>  <!-- /inner-wrapper -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-footer -->
  
  <div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
    <div class="container">  <!-- container -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-post-footer -->

  <!-- JS and analytics only. -->
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="assets/js/bootstrap.min.js"> </script>
  <script type="text/javascript" src="assets/js/respond.min.js"> </script>
  <script type="text/javascript" src="assets/js/anchor.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard-btn.js"> </script>
  <script type="text/javascript" src="assets/js/anchor-hover.js"> </script>
  <!-- Analytics Below
  ================================================== -->
  </body>
</html>

